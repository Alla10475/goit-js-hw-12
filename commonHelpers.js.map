{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport axios from 'axios';\n\nconst modalLightboxGallery = new SimpleLightbox('.photo-container a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nconst refs = {\n  searchForm: document.querySelector('.search-form'),\n  photoListEl: document.querySelector('.photo-list'),\n  loader: document.querySelector('.loader'),\n  loaderLoadMore: document.querySelector('loader-load-more'),\n  loadMoreBtn: document.querySelector('[data-action=\"load-more\"]'),\n};\n\n// const queryParams = {\n//   query: '',\n//   page: 1,\n//   maxPage: 0,\n//   pageSize: 40,\n// };\n\nlet page = 1;\nlet maxPage = 0;\nlet query = '';\n\nconst hiddenClass = 'is-hidden';\n\nrefs.searchForm.addEventListener('submit', handleSearch);\n\nasync function handleSearch(event) {\n  event.preventDefault();\n\n  refs.photoListEl.innerHTML = '';\n\n  refs.loader.classList.remove(hiddenClass);\n\n  page = 1;\n\n  const form = event.currentTarget;\n  query = form.elements.query.value.trim();\n\n  if (!query) {\n     \n      refs.loader.classList.add(hiddenClass);\n\n    iziToast.show({\n      message: 'Please enter your request',\n      position: 'topRight',\n      color: 'yellow',\n    });\n    return;\n    }\n    \n    // refs.loader.classList.add(hiddenClass);\n\n  try {\n    const { hits, totalHits } = await searchPhoto(query);\n\n    maxPage = Math.ceil(totalHits / 40);\n\n    markupPhoto(hits, refs.photoListEl);\n\n    if (hits.length > 0 && hits.length !== totalHits) {\n      refs.loadMoreBtn.classList.remove(hiddenClass);\n      refs.loadMoreBtn.addEventListener('click', handleLoadMore);\n    } else if (!hits.length) {\n    refs.loadMoreBtn.classList.add(hiddenClass);\n\n        iziToast.error({\n          title: 'Error',\n          titleSize: '30',\n          messageSize: '25',\n          message:\n            'Sorry, there are no images matching your search query. Please try again!',\n        });\n    } else {\n      refs.loadMoreBtn.classList.add(hiddenClass);\n    }\n  } catch (err) {\n    console.log(err);\n  } finally {\n      refs.loader.classList.add(hiddenClass);\n      form.reset();\n  }\n}\n\nasync function searchPhoto(value, page = 1) {\n  const BASE_URL = 'https://pixabay.com/api';\n  const API_KEY = '41870399-9b44301246ceb98c07efd626a';\n\n  try {\n    const response = await axios.get(`${BASE_URL}/`, {\n      params: {\n        key: API_KEY,\n        q: value,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: 'true',\n        per_page: 40,\n        page,\n      },\n    });\n    return response.data;\n  } catch {\n    iziToast.error({\n      title: 'Error',\n      titleSize: '30',\n      messageSize: '25',\n      message: 'Sorry! Try later! Server not working',\n    });\n    console.error(error.message);\n  }\n}\n\nfunction markupPhoto(hits) {\n  const markup = hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `<li class=\"gallery-item\">\n  <a class=\"gallery-link\" href=\"${largeImageURL}\">\n    <img\n      class=\"gallery-image\"\n      src=\"${webformatURL}\"\n      alt=\"${tags}\"\n    />\n  </a><div class=\"gallery-descr\">\n   <p>Likes: <br><span>${likes}</span></p>\n   <p>Views: <br><span>${views}</span></p>\n   <p>Comment: <br><span>${comments}</span></p>\n   <p>Downloads: <br><span>${downloads}</span></p></div>\n</li>`\n    )\n    .join('');\n\n  refs.photoListEl.insertAdjacentHTML('beforeend', markup);\n  modalLightboxGallery.refresh();\n}\n\nasync function handleLoadMore() {\n  page += 1;\n    refs.loaderLoadMore.classList.remove(hiddenClass);\n    refs.loadMoreBtn.classList.add(hiddenClass);\n    \n    const getHeightImgCard = document\n      .querySelector('.gallery-item')\n      .getBoundingClientRect();\n\n  try {\n    const { hits } = await searchPhoto(query, page);\n\n    markupPhoto(hits, refs.photoListEl);\n  } catch (err) {\n    console.log(err);\n  } finally {\n      window.scrollBy({\n        top: getHeightImgCard.height * 2,\n        left: 0,\n        behavior: 'smooth',\n      });\n      refs.loaderLoadMore.classList.add(hiddenClass);\n      refs.loadMoreBtn.classList.remove(hiddenClass);\n\n    if (page === maxPage) {\n      refs.loadMoreBtn.classList.add(hiddenClass);\n        refs.loadMoreBtn.removeEventListener('click', handleLoadMore);\n        iziToast.show({\n          title: 'Hey',\n          titleSize: '30',\n          messageSize: '25',\n          color: 'blue',\n          position: 'topRight',\n          message: \"We're sorry, but you've reached the end of search results.\",\n        });\n    }\n  }\n}\n\n\n"],"names":["modalLightboxGallery","SimpleLightbox","refs","page","maxPage","query","hiddenClass","handleSearch","event","form","iziToast","hits","totalHits","searchPhoto","markupPhoto","handleLoadMore","err","value","BASE_URL","API_KEY","axios","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","getHeightImgCard"],"mappings":"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"}